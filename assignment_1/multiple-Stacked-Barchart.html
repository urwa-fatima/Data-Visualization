<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script type="text/javascript" src="../d3-7.6.1/package/dist/d3.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <link rel="stylesheet" href="../css/style.css">

</head>

<body>
    <h1>The Stacked Barchart with Small Multiple Neighborhood Vs Tree Type</h1>

    <div id="my_dataviz"></div>
    <p></p>

    <script>

        var tooltip = d3.select("#my_dataviz")
            .append("div")
            .attr("class", "toolTip")
            .style("display", "none");

        // -----------------------------------------------------------------

        // set the dimensions and margins of the graph
        var margin = { top: 30, right: 30, bottom: 40, left: 200 },
            width = 900 - margin.left - margin.right,
            height = 500 - margin.top - margin.bottom;

        var colors = ['#66976B', '#1D382B', '#D68C2C', '#A54A2B',
            '#C7A98C', '#53070D', '#F4A6B3', '#B7264A', '#C5BE6A',
            '#364277', '#8FBFCC', '#226D7B', '#002E6B'];
        var topFiveTreeTypes = ['Celtis australis', 'Aesculus hippocastanum', 'Carpinus betulus', 'Tilia cordata', 'Platanus x hispanica'];

        d3.csv("../data/count_region_treetype_totals.csv").then(function (data) {

            // var regionLst = data.columns.slice(1, data.columns.length - 1);
            var regionLst = d3.map(data, d => d.Regions); //groups
            var treetypes = data.columns.slice(1); // subgroups

            // var groupbyRegion = d3.group(data, d => d.Region)
            // var groupbyTreeType = d3.group(data, d => d.Name)
            // var totalByTreeType = d3.rollup(data, d => d3.sum(d, x => x.count), d => d.Name)
            // var totalByRegion = d3.rollup(data, d => d3.sum(d, x => x.count), d => d.Region)

            // console.log(data);
            // console.log(regionLst);

            var colorScale = d3.scaleOrdinal()
                .domain(treetypes)
                .range(colors);
            // .range(d3.schemeSet3);

            // var stack = d3.stack()
            //     .keys(keys)
            //     .order(d3.stackOrderNone)
            //     .offset(d3.stackOffsetNone);

            // var series = stack(data);
            // console.log(series);


            // ---------------------------------------------------------
            //Create Y-axis once 
            var y = d3.scaleBand()
                .range([0, height])
                .domain(regionLst)
                .padding(.1);

            //-------------------------------------------------------------

            //defineing width for each tree graph

            var maxval = d3.max(data, d => +d['Grand Total']);

            var treegraph_width = width / treetypes.length;

            for (var i = 0; i < treetypes.length; i++) {

                var treegroup = treetypes[i];




            };
            var svg = d3.select("#my_dataviz")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")")
                .attr("fill", "black");

            // var mxcount = d3.max(data, d =>);

            var x = d3.scaleLinear()
                .domain([0, 3000])
                .range([0, width]);

            svg.append("g")
                .call(d3.axisLeft(y));



            //Bars
            svg.selectAll("g.stack")
                .data(series)
                .enter().append("g")
                .attr("class", "stack")
                .attr("fill", function (d) { return colorScale(d.key); })

                .selectAll("rect")
                .data(function (d) { return d; })
                .enter().append("rect")
                .attr("y", function (d) { return y(d.data.Regions); })
                .attr("x", function (d) { return x(d[0]); })
                .attr("height", y.bandwidth())
                .attr("width", function (d) { return x(d[1]) - x(d[0]); })
                .attr("transform", function (d, i) {

                    return x(d[1]) - x(d[0]);
                })
                .on("mousemove", function (d) {

                    tooltip
                        .style("left", d.pageX - 50 + "px")
                        .style("top", d.pageY - 70 + "px")
                        .style("display", "inline-block")
                    // .html((d.data.Region) + "<br>" + (d[1] - d[0]));
                })
                .on("mouseout", function (d) { tooltip.style("display", "none"); });

            // });

        });
    </script>
</body>

</html>